
{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = current_variant.image | default: product.featured_image
  assign secondary_image = product.images[1] | default: product.featured_image
%}

<product-card data-product-handle = "{{ product.handle }}" data-section-id="{{ product.id }}" class="">
    <div>
        <a href="{{ product.url }}"  class="">
        <div class="media media--portrait media--transparent media--hover-effect global-media-settings">
            <img
                srcset="
                {%- if featured_image.width >= 165 -%}{{ featured_image | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if featured_image.width >= 360 -%}{{ featured_image | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if featured_image.width >= 533 -%}{{ featured_image | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if featured_image.width >= 720 -%}{{ featured_image | image_url: width: 720 }} 720w,{%- endif -%}
                {%- if featured_image.width >= 940 -%}{{ featured_image | image_url: width: 940 }} 940w,{%- endif -%}
                {%- if featured_image.width >= 1066 -%}{{ featured_image | image_url: width: 1066 }} 1066w,{%- endif -%}
                {{ featured_image | image_url }} {{ featured_image.width }}w
                "
                src="{{ featured_image | image_url: width: 533 }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt="{{ featured_image.alt | escape }}"
                class="motion-reduce"
                {% unless lazy_load == false %}
                loading="lazy"
                {% endunless %}
                width="{{ featured_image.width }}"
                height="{{ featured_image.height }}"
            >     
            <img
                srcset="
                {%- if secondary_image.width >= 165 -%}{{ secondary_image | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if secondary_image.width >= 360 -%}{{ secondary_image | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if secondary_image.width >= 533 -%}{{ secondary_image | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if secondary_image.width >= 720 -%}{{ secondary_image | image_url: width: 720 }} 720w,{%- endif -%}
                {%- if secondary_image.width >= 940 -%}{{ secondary_image | image_url: width: 940 }} 940w,{%- endif -%}
                {%- if secondary_image.width >= 1066 -%}{{ secondary_image | image_url: width: 1066 }} 1066w,{%- endif -%}
                {{ secondary_image | image_url }} {{ secondary_image.width }}w
                "
                src="{{ secondary_image | image_url: width: 533 }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt=""
                class="motion-reduce "
                loading="lazy"
                width="{{ secondary_image.width }}"
                height="{{ secondary_image.height }}"
            >
            </div>
        </a>
        <div>
            {% for tag in product.tags %}
                {% if tag == "New" %}
                  <div class='product-card_newBadge badge'>New</div>
                {% endif %}
              {% endfor %}          
        </div>
        <div>
            {% comment %} {% assign max_price = current_variant.compare_at_price %}
            {% assign discounted_price = current_variant.price %} {% endcomment %}
            {% if current_variant.compare_at_price != blank %}
                <div class='product-card_discountBadge badge'>
                    {{current_variant.compare_at_price | minus: current_variant.price | times: 100 |  divided_by: current_variant.compare_at_price}}
                </div>
            {% endif %}        
        </div>
        <div class="product-card__info">
            <div class='h4'>{{ product.vendor }}</div>
            <a href="{{ product.url }}" class="product-card__title h3">{{ product.title }}</a>
            <div class='jdgm-widget jdgm-preview-badge'>
                {{ product.metafields.judgeme.badge }}
              </div>
    
            <div class="product-card__prices">
            <span class="product-card__price">{{ current_variant.price | money_without_trailing_zeros }}</span>
    
            {% if current_variant.compare_at_price > current_variant.price %}
              <s class="product-card__compareprice">{{ current_variant.compare_at_price | money_without_trailing_zeros }}</s>
            {% endif %}
            </div>
                <div class='h4 {% if current_variant.inventory_quantity > 10 %}product-card__inventory-green{% else %}product-card__inventory-red{% endif %}'>
                  {{ current_variant.inventory_quantity }} in stock
                </div>
            <div class="product-card__form">
            {% form 'product', product %}
                <input type="hidden" name="id" value="{{ current_variant.id }}">
    
                {% unless product.has_only_default_variant %}
                <div class="product-card__options"> 
                    {% for product_option in product.options_with_values %}
                    <div class="product-card__option">
                        {% if product_option.name == 'Color'  %}
                            <ul>
                            {% for option_value in product_option.values %}
                                <input class=''
                                    id="{{ option_value }}"
                                    type="radio" 
                                    name="option-{{ product_option.name | handleize }}" 
                                    value="{{ option_value }}"
                                    {% if product_option.selected_value == option_value %}checked{% endif %}
                                >
                                <label for="{{ option_value }}" class="product-card__borderColor">
                                  <span class='product-card__varient-color' style="background-color: {{ option_value }};"></span>
                                </label>
                                {% comment %} {{ option_value }} {% endcomment %}
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endunless %}
                
    
                {% if current_variant.available %}
                <button type="submit" class="button">Add to cart</button>
                {% else %}
                <button type="button" class="button" disabled>Sold out</button>
                {% endif %}

                {%- if product.metafields.reviews.rating.value != blank -%}
                    {% liquid
                      assign rating_decimal = 0
                      assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1
                      if decimal >= 0.3 and decimal <= 0.7
                        assign rating_decimal = 0.5
                      elsif decimal > 0.7
                        assign rating_decimal = 1
                      endif
                    %}
                    <div
                      class="rating"
                      role="img"
                      aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}"
                    >
                      <span
                        aria-hidden="true"
                        class="rating-star"
                        style="--rating: {{ product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                      ></span>
                    </div>
                    <p class="rating-text caption">
                      <span aria-hidden="true">
                        {{- product.metafields.reviews.rating.value }} /
                        {{ product.metafields.reviews.rating.value.scale_max -}}
                      </span>
                    </p>
                    <p class="rating-count caption">
                      <span aria-hidden="true">({{ product.metafields.reviews.rating_count }})</span>
                      <span class="visually-hidden">
                        {{- product.metafields.reviews.rating_count }}
                        {{ 'accessibility.total_reviews' | t -}}
                      </span>
                    </p>
                  {%- endif -%}
            {% endform %}
            </div>
        </div>
    </div>
    <script>
      {{ product.variants | json }}
    </script>
</product-card>